---
- hosts: servers
  gather_facts: no
  roles:
  - { role: hostname, when: hostname is defined }
  - { role: user, when: user_list is defined }
  - ssh
  - { role: network, when: network_list is defined }
  - role: firewall
    when: service_list is defined or port_list is defined
  - locale
  - update

- hosts: servers
  gather_facts: no
  vars:
    ansible_ssh_user: after_ssh_user
    ansible_ssh_private_key_file: after_ssh_private_key_file
  role:
  - reboot